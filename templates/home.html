<!DOCTYPE html>
<html>
    <head>
        <title> Chess </title>
        <link rel="stylesheet" href="{{ url_for('static',filename='css/main.css') }}">

    </head>
    <body>
        <header>
        <div class="home">
            <h2 class="logo"> Chess </h2>
            <h3> It's a lovely afternoon for a clash of flesh and silicon. </h3>




            <h3>
            <button type="button" onclick="start_game()">New Game</button>

            <p> </p>

            <img id="cover" src='{{ url_for('static',filename="png/cover_photo.jpg") }}' style="width:1000px">
            </h3>

            <p align="center">
                <canvas id="board" width="600" height="600" style="border:3px solid #000000" style="display:none">
                    Your browser does not support canvas.
                </canvas>
            <p>


            <strong><nav>
                <ul class="menu">

                    <li> <a href="{{ url_for('about') }}">About</a></li>

                </ul>
            </nav></strong>
            <br> </br>
        </div>
        <div class="container">
            {% block content %}
            {% endblock %}
        </div>
        </header>

        <script>
        const boardCanvas = document.getElementById('board');
        boardCanvas.style.display = "none";
        boardCanvas.addEventListener('click', (e) => {
            alert('clicked on board');
        } );

        class Loc {
            /* can be pixel location or board location,
                depending on context */
            constructor(i,j) {
                this.i = i;
                this.j = j;
            }
            loc_equals(loc2) {
                /* is LOC equivalent to arg LOC2? */
                return ((this.i == loc2.i) && (this.j == loc2.j));
            }
        }

        function get_piece_art_filepath(sq) {
            /* returns filepath to piece art, or "" if empty square */
            if(sq == '-') {
                return "";
            }
            var file_lookup = {
                'p':"white_pawn.png",
                'P':"black_pawn.png",
                'R':"black_rook.png",
                'N':"black_knight.png",
                'B':"black_bishop.png",
                'Q':"black_queen.png",
                'K':"black_king.png",
                'r':"white_rook.png",
                'n':"white_knight.png",
                'b':"white_bishop.png",
                'q':"white_queen.png",
                'k':"white_king.png"
            };
            return "/static/png/piece_art/" + file_lookup[sq];

        }

        function print_square(color,sideLen,topLeft,pc) {
            var b = document.getElementById('board');
            var ctx = b.getContext('2d');
            ctx.fillStyle = color;
            ctx.fillRect(topLeft.i,topLeft.j,sideLen,sideLen);

            if (pc != '-') {
                var fp_image = get_piece_art_filepath(pc);
                var image = new Image();
                var b = document.getElementById('board');
                var ctx = b.getContext('2d');
                image.src = fp_image;
                image.onload = function () {//waits for image to load
                    ctx.drawImage(image,topLeft.i,topLeft.j,sideLen,sideLen);
                };

            }
        }

        function get_click_location(canvas, event) {
            var bounds = canvas.getBoundingClientRect();
            var x = event.clientX - rect.left;
            var y = event.clientY - rect.top;
            return new Loc(x,y)
        }

        class Board {

            constructor(squares,screen_size,light,dark) {
                this.squares = squares; // 8x8 grid (nested arrays)
                this.playing = true;
                this.screen_size = screen_size; // square
                this.sideLen = screen_size / 8;
                // colors of squares:
                this.light = light;
                this.dark = dark;
                //this.highlights = new Highlights();
            }

            get_piece(loc) {
                var index = loc.i + loc.j * 8;
                return this.squares.charAt(index);
            }

            print_board() {
                for(var i = 0; i < 8; i++) {
                    for(var j = 0; j < 8; j++) {
                        var x = i * this.sideLen;
                        var y = j * this.sideLen;
                        var sqLoc = new Loc(x,y);
                        var isLight = (((i % 2 == 0) && (j % 2 == 0)) ||
                        (i % 2 == 1) && (j % 2 == 1));
                        var color;
                        if(isLight) {
                            color = this.light;
                        } else {
                            color = this.dark;
                        }
                        var pcLoc = new Loc(i,j)
                        var pc = this.get_piece(pcLoc);
                        print_square(color,this.sideLen,sqLoc,pc);
                        }
                    }
                }
            }

        function start_game() {
            document.getElementById("cover").style.display = "none";
            var b = document.getElementById('board');
            b.style.display = "block";
            b.margin = "auto";
            b.padding="0";
            var light = "#DFE8EE";
            var dark = "#2970A0";
            var squares = "RNBQKBNRPPPPPPPP--------------------------------pppppppprnbqkbnr";
            var gameBoard = new Board(squares,600,light,dark);
            gameBoard.print_board();
        }
        </script>

    </body>
</html>