{"version":3,"sources":["board.js"],"names":["NeighborType","Above","offset","AboveLeft","AboveRight","Below","BelowLeft","BelowRight","KnightAboveLeft","KnightAboveRight","KnightBelowLeft","KnightBelowRight","KnightLeftAbove","KnightLeftBelow","KnightRightAbove","KnightRightBelow","Left","Right","Board","squares","sq","n","file","rank","fIndex","indexOf","i","length","f","r","charAt","side","list","piece","push","src","dest","getSquare","simulate","move","algebraic","capturedPiece","castle","enPassant","postSquare","prevSquare","p","undo","b","m","type","PieceType","King","moveCount","Pawn","lastMovedPiece","emit","Math","floor","Square","create","Piece","createRook","SideType","White","Black","createKnight","createBishop","createQueen","createKing","createPawn","EventEmitter"],"mappings":"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","sourcesContent":["/**\n\tThe Board is the representation of the current position of the pieces on\n\tthe squares it contains.\n*/\nimport { Piece, PieceType, SideType } from './piece';\nimport { EventEmitter } from 'events';\nimport { Square } from './square';\n\n// types\nexport var NeighborType = {\n\tAbove : { offset : 8 },\n\tAboveLeft : { offset : 7 },\n\tAboveRight : { offset : 9 },\n\tBelow : { offset : -8 },\n\tBelowLeft : { offset : -9 },\n\tBelowRight : { offset : -7 },\n\tKnightAboveLeft : { offset : 15 },\n\tKnightAboveRight : { offset : 17 },\n\tKnightBelowLeft : { offset : -17 },\n\tKnightBelowRight : { offset : -15 },\n\tKnightLeftAbove : { offset : 6 },\n\tKnightLeftBelow : { offset : -10 },\n\tKnightRightAbove : { offset : 10 },\n\tKnightRightBelow : { offset : -6 },\n\tLeft : { offset : -1 },\n\tRight : { offset : 1 }\n};\n\n// ctor\nexport class Board extends EventEmitter {\n\tconstructor (squares) {\n\t\tsuper();\n\n\t\tthis.squares = squares;\n\t}\n\n\tstatic create () {\n\t\tlet\n\t\t\tb = new Board([]),\n\t\t\tf = 0,\n\t\t\ti = 0,\n\t\t\tr = 0,\n\t\t\tsq = null;\n\n\t\t/* eslint no-magic-numbers:0 */\n\t\tfor (i = 0; i < 64; i++) {\n\t\t\tf = Math.floor(i % 8);\n\t\t\tr = Math.floor(i / 8) + 1;\n\t\t\tsq = Square.create('abcdefgh'[f], r);\n\n\t\t\tb.squares.push(sq);\n\n\t\t\tif (r === 1 || r === 8) { // Named pieces\n\t\t\t\tif (f === 0 || f === 7) { // Rookage\n\t\t\t\t\tsq.piece = Piece.createRook(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 1 || f === 6) { // Knights\n\t\t\t\t\tsq.piece = Piece.createKnight(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 2 || f === 5) { // Bish's\n\t\t\t\t\tsq.piece = Piece.createBishop(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 3) {\n\t\t\t\t\tsq.piece = Piece.createQueen(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsq.piece = Piece.createKing(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (r === 2 || r === 7) { // Pawns\n\t\t\t\tsq.piece = Piece.createPawn(\n\t\t\t\t\tr === 2 ? SideType.White : SideType.Black\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn b;\n\t}\n\n\tgetNeighborSquare (sq, n) {\n\t\tif (sq && n) {\n\t\t\t// validate boundaries of board\n\t\t\tif (sq.file === 'a' && (n === NeighborType.AboveLeft ||\n\t\t\t\t\tn === NeighborType.BelowLeft ||\n\t\t\t\t\tn === NeighborType.Left)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.file === 'h' && (n === NeighborType.AboveRight ||\n\t\t\t\t\tn === NeighborType.BelowRight ||\n\t\t\t\t\tn === NeighborType.Right)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.rank === 1 && (n === NeighborType.Below ||\n\t\t\t\t\tn === NeighborType.BelowLeft ||\n\t\t\t\t\tn === NeighborType.BelowRight)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.rank === 8 && (n === NeighborType.Above ||\n\t\t\t\t\tn === NeighborType.AboveLeft ||\n\t\t\t\t\tn === NeighborType.AboveRight)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// validate file\n\t\t\tlet\n\t\t\t\tfIndex = 'abcdefgh'.indexOf(sq.file),\n\t\t\t\ti = 0;\n\n\t\t\tif (fIndex !== -1 && sq.rank > 0 && sq.rank < 9) {\n\t\t\t\t// find the index\n\t\t\t\ti = 8 * (sq.rank - 1) + fIndex + n.offset;\n\t\t\t\tif (this.squares && this.squares.length > i && i > -1) {\n\t\t\t\t\treturn this.squares[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSquare (f, r) {\n\t\t// check for shorthand\n\t\tif (typeof f === 'string' && f.length === 2 && !r) {\n\t\t\tr = parseInt(f.charAt(1), 10);\n\t\t\tf = f.charAt(0);\n\t\t}\n\n\t\t// validate file\n\t\tlet\n\t\t\tfIndex = 'abcdefgh'.indexOf(f),\n\t\t\ti = 0;\n\n\t\tif (fIndex !== -1 && r > 0 && r < 9) {\n\t\t\t// Find the index\n\t\t\ti = 8 * (r - 1) + fIndex;\n\t\t\tif (this.squares && this.squares.length > i) {\n\t\t\t\treturn this.squares[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSquares (side) {\n\t\tlet\n\t\t\ti = 0,\n\t\t\tlist = [];\n\n\t\tfor (i = 0; i < this.squares.length; i++) {\n\t\t\tif (this.squares[i].piece &&\n\t\t\t\t\tthis.squares[i].piece.side === side) {\n\t\t\t\tlist.push(this.squares[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\tmove (src, dest, n) {\n\t\tif (typeof src === 'string' &&\n\t\t\t\tsrc.length === 2) {\n\t\t\tsrc = this.getSquare(src);\n\t\t}\n\n\t\tif (typeof dest === 'string' &&\n\t\t\t\tdest.length === 2) {\n\t\t\tdest = this.getSquare(dest);\n\t\t}\n\n\t\tlet simulate = false;\n\n\t\tif (typeof n === 'boolean') {\n\t\t\tsimulate = n;\n\t\t\tn = null;\n\t\t}\n\n\t\tif (src && src.file && src.rank &&\n\t\t\t\tdest && dest.file && dest.rank) {\n\t\t\tlet\n\t\t\t\tmove = {\n\t\t\t\t\talgebraic : n,\n\t\t\t\t\tcapturedPiece : dest.piece,\n\t\t\t\t\tcastle : false,\n\t\t\t\t\tenPassant : false,\n\t\t\t\t\tpostSquare : dest,\n\t\t\t\t\tprevSquare : src\n\t\t\t\t},\n\t\t\t\tp = src.piece,\n\t\t\t\tsq = null,\n\t\t\t\tundo = (b, m) => {\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tm.prevSquare.piece = m.postSquare.piece;\n\t\t\t\t\t\tm.postSquare.piece = m.capturedPiece;\n\n\t\t\t\t\t\tif (!m.enPassant) {\n\t\t\t\t\t\t\tm.postSquare.piece = m.capturedPiece;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tb.getSquare(m.postSquare.file,\n\t\t\t\t\t\t\t\tm.prevSquare.rank).piece = m.capturedPiece;\n\n\t\t\t\t\t\t\t// there is no piece on the post square in the event of\n\t\t\t\t\t\t\t// an en-passant, clear anything that me be present as\n\t\t\t\t\t\t\t// a result of the move (fix for issue #8)\n\t\t\t\t\t\t\tm.postSquare.piece = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (m.castle) {\n\t\t\t\t\t\t\tsq = b.getSquare(\n\t\t\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'f' : 'd',\n\t\t\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tb.getSquare(\n\t\t\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'h' : 'a',\n\t\t\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t\t\t).piece = sq.piece;\n\t\t\t\t\t\t\tsq.piece = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\tdest.piece = p;\n\t\t\tmove.castle = p.type === PieceType.King &&\n\t\t\t\tp.moveCount === 0 &&\n\t\t\t\t(move.postSquare.file === 'g' || move.postSquare.file === 'c');\n\t\t\tmove.enPassant = p.type === PieceType.Pawn &&\n\t\t\t\tmove.capturedPiece === null &&\n\t\t\t\tmove.postSquare.file !== move.prevSquare.file;\n\t\t\tmove.prevSquare.piece = null;\n\n\t\t\t// check for en-passant\n\t\t\tif (move.enPassant) {\n\t\t\t\tsq = this.getSquare(move.postSquare.file, move.prevSquare.rank);\n\t\t\t\tmove.capturedPiece = sq.piece;\n\t\t\t\tsq.piece = null;\n\t\t\t}\n\n\t\t\t// check for castle\n\t\t\tif (move.castle) {\n\t\t\t\tsq = this.getSquare(\n\t\t\t\t\tmove.postSquare.file === 'g' ? 'h' : 'a',\n\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t);\n\n\t\t\t\tif (sq.piece === null) {\n\t\t\t\t\tmove.castle = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.getSquare(\n\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'f' : 'd',\n\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t).piece = sq.piece;\n\t\t\t\t\tsq.piece = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!simulate) {\n\t\t\t\tp.moveCount++;\n\t\t\t\tthis.lastMovedPiece = p;\n\t\t\t\tthis.emit('move', move);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmove,\n\t\t\t\tundo : undo(this, move, simulate)\n\t\t\t};\n\t\t}\n\t}\n\n\tpromote (sq, p) {\n\t\t// update move count and last piece\n\t\tp.moveCount = sq.piece.moveCount;\n\t\tthis.lastMovedPiece = p;\n\n\t\t// set to square\n\t\tsq.piece = p;\n\n\t\tthis.emit('promote', sq);\n\n\t\treturn sq;\n\t}\n}\n\n// exports\nexport default { Board, NeighborType };\n"],"file":"board.js"}